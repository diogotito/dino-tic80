-- title:   game title
-- author:  game developer, email, etc.
-- desc:    short description
-- site:    website link
-- license: MIT License (change this to your license of choice)
-- version: 0.1
-- script:  lua

TILE_SKY = 1
TILE_GRASS = 6
TILE_BGGRASS = 7
TILE_BG, N_BG = 18, 2
TILE_DUG = 22
AUTOTILE_BASE = 127

FLAG_HOLLOW = 0
FLAG_DIRT   = 1
FLAG_GRASS  = 2
FLAG_BUILDG = 3

C_BG    = 0
C_DIRT1 = 1
C_DIRT2 = 2

LAYER_COLORS = {
	{ below_y=10, {
		[C_DIRT1] = { 79,  40,  30},
		[C_DIRT2] = { 90,  50,  20},
	}},
	{ below_y=20, {
		[C_DIRT1] = { 35,  44,   9},
		[C_DIRT2] = { 10,  70,  50},
	}},
	{ below_y=30, {
		[C_DIRT1] = { 48,  30,   8},
		[C_DIRT2] = { 28,  10,  12},
	}},
}
-- sort by descending depth
table.sort(LAYER_COLORS,function(l1,l2)
	return l1.below_y > l2.below_y
end)

function LAYER_COLORS:at(depth)
	for _, layer in ipairs(self) do
		if depth >= layer.below_y * 8 then
			return layer[1]
		end
	end
	return {}
end

-- find first Y with dirt
GROUND_Y = (function()
	for y=0,135 do
		if not fget(mget(0,y), FLAG_HOLLOW) then
			return y
		end
	end
end)()


--------------------------------------
-- TIC cart lifecycle
--------------------------------------

t = 0

function BOOT()
	-- background music
	music(0)
	pal:grab()
end


function BDR(scanline)
	pal:restore()

	local Y0 = 8*GROUND_Y
	local depth = cam.y-Y0 + scanline-4

	pal.apply_changes(LAYER_COLORS:at(depth))

	pal.apply_tint(
	  clamp(1 - depth/350, 0, 1))

	pal.apply_tint(
	  clamp(1 - 0.9*((scanline-70) / 70)^4, 0, 1))

	local flick = 0.15 * ((t+scanline)%2)

	-- top border
	if scanline < 4 then
		local mul = 1-(.7-flick)*(scanline)/3
		pal.apply_tint(mul)
	-- tinted HUD backdrop with flickering
	elseif scanline >= 4 and
	       scanline < 14 then
		local mul=0.2+flick
		pal.apply_tint(mul)
	-- HUD bottom transparency falloff
	elseif scanline >= 14 and
	       scanline <  17 then
		local mul = 1-(.7-flick)
		              *(17-scanline)/3
		pal.apply_tint(mul)
	-- below the HUD
	elseif scanline == 17 then
		pal.apply_tint(1)
	end
end


function TIC()
	cam:move()

	cls()

	local tx,ty, sx,sy

	-- sky/underground background
	tx,ty, sx,sy = cam:parallax(0.5)
	map(tx,ty, 32,19, sx,sy, -1, 1,
	    function (_id, x, y)
	    	if y+ty < GROUND_Y then
	    		-- Sky backgrund
	    		return TILE_SKY
	    	else
	    		-- underground bg pattern
	    		return TILE_BG + (x+y) % N_BG
	    	end
	    end)

	-- praise the sun!
	clip(0, 0, 240, 8 * GROUND_Y - cam.y)
	circ(234, 4, 16, 4)
	clip() -- I could use clip more!

	-- sky landscape parallax
	tx,ty, sx,sy = cam:parallax(0.1, 0.25)
	local rows = GROUND_Y - cam.y // 8
	map(tx,ty, 34,rows, sx,sy, 0, 1,
	    function(id, _x, _y)
	    	if fget(id, FLAG_HOLLOW) then
	    		return id
	    	end
	    end)

	tx,ty, sx,sy = cam:parallax(1)

	-- grass sideways parallax
	local gpx,_, gsx = cam:parallax(0.5)
	map(gpx,ty, 32,19, gsx,sy, 0, 1,
	    function(_id, _x, y)
	    	if y == GROUND_Y-1 then
	    		return TILE_BGGRASS
	    	end
	    end)

	-- ground-level buildings
	map(tx,ty, 31,18, sx,sy, {0,15}, 1,
	    function(id, _x, _y)
	    	if fget(id, FLAG_BUILDG) then
							return id
						end
	    end)

	-- paint dirt tiles
	map(tx,ty, 31,18, sx,sy, {0,15}, 1,
	    remap_dirt_tiles)

	-- edge effect (autotile)
	map(tx,ty, 31,18, sx,sy, {0,15}, 1,
	    autotile_dirt_edge)

	-- more grass! downards! rotated!
	map(tx,ty, 31,18, sx,sy, {0,15}, 1,
	    function (id, x, y)
	    	local above = mget(x, y-1)
	    	if y == GROUND_Y and (
	    	   above == TILE_GRASS or
	    	   fget(above, FLAG_BUILDG)) then
	    		return TILE_GRASS, 0, 2
	    	end
	    end)

	draw_hud(tx, ty, t)

	t = t + 1
end

--------------------------------------

function remap_dirt_tiles(id, x, y)
	if id == TILE_DUG then
		local up   = mget(x, y-1)
		local down = mget(x, y+1)
		if up~=TILE_DUG and fget(up,FLAG_HOLLOW) then
			return 38
		elseif down~=TILE_DUG and fget(down,FLAG_HOLLOW) then
			return 70
		else
			return 54
		end
	elseif y >= GROUND_Y then
		return id
	end
end

-- Dirt tunnel edge effect autotiling
-- remap funcion
function autotile_dirt_edge(id, x, y)
	if not fget(id, FLAG_HOLLOW) then
		return 0 -- a transparent tile
	end

	if fget(id, FLAG_GRASS) then
		return id
	end

	id = AUTOTILE_BASE
	for i,adj in ipairs{{x=x  , y=y-1},
	                    {x=x  , y=y+1},
	                    {x=x-1, y=y  },
	                    {x=x+1, y=y  }} do
		local adj_id = mget(adj.x, adj.y)
		if fget(adj_id, FLAG_DIRT) then
			id = id + (1 << (i-1))
		end
	end
	return id
end


function draw_hud(tx, ty, t)
	local function hud_txt(txt, x)
		local SH = 10 -- text shadow
		local FG = 12 -- text foreground
		local  Y = 3
		print(txt, x+1, Y+1, SH, true)
		print(txt, x  , Y  , FG, true)
	end

	local mm,ss = t//60^2, t//60%60
	local sep=(t%60 < 30) and ":" or " "
	local txt1, txt2 =
			("%02d/%02d"):format(tx,ty),
			("%2d%s%02d"):format(mm,sep,ss)
	hud_txt(txt1,  16)
	hud_txt(txt2, 202)

	spr(176, 5, 2, {0})
	spr(177+t//3%10, 195, 1+t%60//30, {0})
end


-- camera ----------------------------

CAM_SPEED = 1.0
cam = { x=0, y=0 }

function cam:move()
	local UP, DOWN, LEFT, RIGHT, A, B =
	  0, 1, 2, 3, 4, 5

	local speed = CAM_SPEED
	  * (btn(A) and 2.0 or 1) -- faster
	  * (btn(B) and 0.5 or 1) -- slower

	local dx, dy =
		btoi(btn(RIGHT)) - btoi(btn(LEFT)),
		btoi(btn(DOWN))  - btoi(btn(UP))

	self.x, self.y =
		clamp(self.x + speed * dx, 0, 239),
		clamp(self.y + speed * dy, 0, 272)
end

-- Compute parallaxed map() parameters
function cam.parallax(pos, x_mul, y_mul)
	y_mul = y_mul or x_mul
	local x,y = x_mul*pos.x, y_mul*pos.y
	return x//8,y//8, -(x%8),-(y%8)
end

-- palette tinting -------------------

N_PALS = 10
PAL    = 0x3FC0

pal = {}

function pal:grab()
	for byte=0, 3*N_PALS - 1 do
		self[byte] = peek(PAL + byte)
	end
end

function pal:restore()
	for byte=0, 3*N_PALS - 1 do
		poke(PAL + byte, self[byte])
	end
end

function pal.apply_tint(mul)
	for byte=0, 3*N_PALS - 1 do
		poke(PAL + byte,
		     lerp(peek(PAL + byte % 3),
				        peek(PAL + byte),
				        mul))
	end
end

function pal.apply_dim(mul)
	for byte=0, 3*N_PALS - 1 do
		poke(PAL+byte, peek(PAL+byte)* mul)
	end
end

function pal.apply_changes(color_changes)
	for idx, rgb in pairs(color_changes) do
		local r, g, b = unpack(rgb)
		poke(PAL + 3*idx    , r)
		poke(PAL + 3*idx + 1, g)
		poke(PAL + 3*idx + 2, b)
	end
end


--------------------------------------
-- utils
--------------------------------------

unpack = table.unpack

function btoi(b)
	return b and 1 or 0
end

function clamp(v,min,max)
	return math.max(math.min(v,max),min)
end

function lerp(from, to, factor)
	return from + factor * (to - from)
end

-- <TILES>
-- 001:9999999999999999999999999999999999999999999999999999999999999999
-- 006:0000000000000000000000000000000000000000040000004500400044444404
-- 007:0000000000000003030000030300300303303033333333333333333333333333
-- 009:0000000000000000000000000000000000000000000000000000000900000098
-- 010:0000000000000000000000000000009900000988000098880000888899098888
-- 011:0000000000000000000000000000000090900000898909008888989088888880
-- 012:0000000000000000000000000000000000000000000000000000000090990000
-- 016:1111111111111111166216612662261221112622111112211611661116111111
-- 017:1111111111266111222221112111221216111222166111211611111111111161
-- 018:0000000000200000000001000000000000000000001000000000001000000000
-- 019:0000000000000010010000000000000000002000000000000000001000000000
-- 022:3333333333333333333333333333333333333333333333333333333333333333
-- 023:3333333333333333333333333333333333333333333333333333333333333333
-- 025:0909098808989808088888878888888888888888788787877878787807777770
-- 026:8898088888880888888887888888888880888888878787870778787800777700
-- 027:8888887988888808888888878808888888888888808787780778780700777007
-- 028:8988900088888900888888808888888088878880787088808780788877007770
-- 032:9818111199111891911919191111111119119119981981911911911991111191
-- 033:1111111111111111111111111111111111111111111111111111111111111111
-- 035:0000000000001000000000000070007000700070076703670367076776633666
-- 038:2333333222323232232233222222322322222322233223323222322322322322
-- 049:0000000000000000000000000000000000006666000660660006666600066666
-- 050:0000000000000000000000000000000066600000666600006666000066660000
-- 054:2232232222322322233333333322232223222322232232333333333222322322
-- 059:0000000000000000000000000000000000007777007700000700000070000000
-- 060:0000000000000000000000000000000077770000000077000000007000000007
-- 064:0000000060000000600000006600006666600666666666666666666606666666
-- 065:0006666600666666666666606666666666666600666666006666666666666606
-- 066:6666000066660000000000006600000000000000000000000000000000000000
-- 070:2230322202222320223202220322033002022202002202020002020000000000
-- 074:0000000700000070000007000000700000070000007000000700000070000000
-- 075:0000000000700000070000700000070000007000000700000000000000000000
-- 076:0000000000000000000000000000000077777777000000000000000000000000
-- 077:7000000007000000007000000007000000007000000007000000007000000007
-- 080:0066666600066666000066660000066600000666000006600000060000000660
-- 081:6666660066666600666660006666000006600000006000000060000000660000
-- 083:f35555ff3f3333fff555555fff6060ffff6666fff63222ffff22225ff5ffffff
-- 084:ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
-- 089:0000000700000000000007000000000000070000000000000700000000000000
-- 090:0000000000000077000007550000755500075555000555550075555500555555
-- 091:7777777755555555557575755757575755555555555555555555555557777775
-- 092:7777777755555555757555555755577755557342555734245557122255573424
-- 093:0000000077000000557000007557000047557000447570002175570043755700
-- 094:7000000000000000007000000000000000007000000000000000007000000000
-- 099:0055550000444400055555500066660000166100043113407033330700500500
-- 104:0000000000000070000000000000000000000000000000000700000000000000
-- 106:0755555507555557055555570555557275555572555555725455557244545472
-- 107:7226222722262227226222222262222222622622226261622262262222622222
-- 108:5555731355555777755555557555555575555555755555557555555575455454
-- 109:3755557075555570555555705555557055555557555555574554545445444444
-- 111:0000000007000000000000000000000000000000000000000000007000000000
-- 128:1111111101010101000000000000000000000000000000000000000000000000
-- 129:0000000000000000000000000000000000000000000000001010101011111111
-- 130:1111111101010101000000000000000000000000000000001010101011111111
-- 131:1100000010000000110000001000000011000000100000001100000010000000
-- 132:1111111111010101100000001100000010000000110000001000000011000000
-- 133:1100000010000000110000001000000011000000100000001101010111111111
-- 134:1111111111010101100000001100000010000000110000001010101011111111
-- 135:0000000100000011000000010000001100000001000000110000000100000011
-- 136:1111111101010101000000110000000100000011000000010000001100000001
-- 137:0000001100000001000000110000000100000011000000011010101111111111
-- 138:1111111101010101000000110000000100000011000000011010101111111111
-- 139:1000001111000001100000111100000110000011110000011000001111000001
-- 140:1111111111010101100000111100000110000011110000011000001111000001
-- 141:1000001111000001100000111100000110000011110000011010101111111111
-- 142:1111111110101011110000111000000111000011100000011110101111111111
-- 176:0000a000000ada0000adaa000adddda000aaada0000ada0000ada000000a0000
-- 177:0a0000a0aeaaaaea0aeeeea0aedcadeaadccacdaaedccdea0aeeeea000aaaa00
-- 178:0a0000a0aeaaaaea0aeeeea0aedccaeaadccacdaaedccdea0aeeeea000aaaa00
-- 179:0a0000a0aeaaaaea0aeeeea0aedccdeaadccaadaaedccdea0aeeeea000aaaa00
-- 180:0a0000a0aeaaaaea0aeeeea0aedccdeaadccacdaaedccaea0aeeeea000aaaa00
-- 181:0a0000a0aeaaaaea0aeeeea0aedccdeaadccacdaaedcadea0aeeeea000aaaa00
-- 182:0a0000a0aeaaaaea0aeeeea0aedccdeaadcaccdaaedacdea0aeeeea000aaaa00
-- 183:0a0000a0aeaaaaea0aeeeea0aedccdeaadcaccdaaeaccdea0aeeeea000aaaa00
-- 184:0a0000a0aeaaaaea0aeeeea0aedccdeaadaaccdaaedccdea0aeeeea000aaaa00
-- 185:0a0000a0aeaaaaea0aeeeea0aeaccdeaadcaccdaaedccdea0aeeeea000aaaa00
-- 186:0a0000a0aeaaaaea0aeeeea0aedacdeaadcaccdaaedccdea0aeeeea000aaaa00
-- </TILES>

-- <MAP>
-- 000:101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 001:10001000000000000000000000a30000000000000000000000000090a0b0c0000000000000000000000000000000000000000000000090a0b0c090a0b0c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 002:10100000000000000000000000000000000000a3b3c3d30000000091a1b1c1c0000000000000000000a3b3c3d30000000000a3b3c3d391a1b1c191a1b1c1c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 003:100010000000000000000000a3b3c3d3a3b3c3a4b4c4d4000000000091a1b1c10000a3b3c3d3a3b3c3a4b4c4d4000000b3c3a4b4c4d40091a1b1c191a1b1c1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 004:101000000000000000000000a4b4c4d4a4b4c4d4000000d400000000000000000000a4b4c4d4a4b4c4d4000000d40000b4c4d4000000d40000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 005:10001000b3c4c3000000009500000000d4000000d4000000d40000000090a0b0c09500000000d4000000d4000000d400000000d4000000d400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 006:10100095b4b400e5000086000090a0b0a5b5c5d500e5000000e5000000000000860000000000000000000090a0b0a5b5c5d5a5b5c5d50000e5000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 007:60600000606060600000606060606060a6b6c6d6600000000000f600006060606060000000006060606060606060a6b6c6d6a6b6c6d6606060606060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 008:011161610111011161610111011101110111011101616161616161616111011101116161616101110111011101110111011101110111011101110111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 009:011100000111011161610111011101110111011101000061616100610011011101110161616101110111011101616161616161616161616161616111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 010:011100000111011161610111011101110111011101000000000000000011011101110111616101110111011101616161616161616112611261616111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 011:011100000111011161610111011101110111011101000000000000000011011101110111016161610111011101616112616112611261120012616111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 012:011100000111011161610111011101110111011101110000000000000011011101110111011161616161011101000000610000120012001200000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 013:011100000111011161610111616161616161011101110111010000000011011101110111011101000061011101000000000012001200120012000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 014:011100000111011161616161616161616161616161610111011100000011011101110111011101110100000001000000000000000012001200000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 015:011101110111011161610111016161610111011161616111011101000011011101110111011101110111000001110111313131313131313131313111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 016:011101110111011161610111011161110111011101616161611101000011011101110111011101110111010000000111323232323232323232323211000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 017:011101110111011161610111011161110111011101110161616101110111011101110111011101110111011100000011011101110111011101110111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 018:011101110111011161610111011161110111011101110111016161110111011101110111011101110111011101000000011101110111011101110111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 019:011101110111011161610111011161110111011101110111011161110111016101110111016101110111011101110000001101110111011101110111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 020:011101110111011161610111011161616161616161616161026161110111011101110111011101110161011101110100000001110111011101110111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 021:011101110111011161610111011161116111016101116111011161110111011101110111011101110111011101110111000001110111011101110111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 022:011101110111011161610111011161116111016101116111011161610111011101110011011100110111011101110111010000110111011101110111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 023:011101110111011161610111011161116111026102116161011161110111011101110111011101110111011100110111011100110111011101110111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 024:011101110111011161610111011161116111026102116161616161110111011101110111011101110111011101110111011100113511011101110111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 025:011101110111011100610111011101110011020202110111011100110111011100110111011101110111010001110111011100110111011101110111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 026:011101110111011100000111011101110011011101110111011100000111011101110111010001110111011101110111011100110111011101110111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 027:011101110111011100000100000000000000000001110111010000110111011101110111011101110111011101110111011136110111011101110111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 028:011101110111011100000100011101110111011101000000000001110111011101110111011101110111011101000111011101110111011101110111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 029:011101110111011100000111010000000000001100000111011101110111011101110111011101110111011101110111011101110111011101110111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 030:011101110111011100000000000000000000000000020211011101110111011101110111111101110111011101110111011101110111011101110111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 031:011101110111011100000111011101110111011102023200000000000000000000000000001111111111000000000000000000000000000000000000001100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 032:011101110111011100000111011101110111011101110111011101110111011100000000000000000000000000000000000000000000111111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 033:011101110111011100000111011101110111011101110111011101110111011111111111000011111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 034:011101110111011100000111011101110111011101110111011101110111011101110111111111110111011101110111011101110111011101110111011101110111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 035:011101110111000000000000011101110111011101110111011101110111011101110111011101110111011101110111011101110111011101110111011101110111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 036:011101110111011100000111011101110111011101110111011101110111011102020102011101110111011101110111001101110111011101110111011101110111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 037:011101110111011100000111011101110111011101110111011101110111011102020111010202110111011101110111001101110111011101110111011101110111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 038:011101110000000000000000000001110111011101110111011101110111011102110102010201020111011101110100000001110111011101110111011101110111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 039:011101110111011100000111011101110111011101110111011101110111011101110111011101110111011101110000000000110111011101110111011101110111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 040:011101110111011100000111011101110111011101110111011101110111011101020111021101020111011101000000000000000111011101110111011101110111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 041:011100000000000000000000000000000111011101110111011101110111011102020102021102110111011101000000000000000111011101110111011101110111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 042:011101110111011100000111011101110111011101110111011101110111011101020111021101020111011101000000000000000111011101110111011101110111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 043:011101110111011100000111011101110111011101110111011101110111011102110111011102110111011101110000000000110111011101110111011101110111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 044:011101110111011100000111011101110111011101110111011101110111011101110111011101110111011101110111111101110111011101110111011101110111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 045:011101110111011100000111011101110111011101110111011101110111011101110111011101110111011101110111011101110111011101110111011101110111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 046:011101110111011100000111011101110111011101110111011101110111011101110111011101110111011101110111011101110111011101110111011101110111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 047:031323000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011000000000111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 048:041424000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011000000000111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 049:051525000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011000000000111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 050:011101110111011111111111011101110111011101111111111101110111011101110111011101111111110111011111111111111111110100000011110111010111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 051:111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111100000011110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 052:000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </MAP>

-- <WAVES>
-- 000:fffedca8654322110000000000000000
-- 001:0123456789abcdeffedcba9876543210
-- 002:0123456789abcdef0123456789abcdef
-- 003:9bcdeeffffeedcb96432110000112346
-- 004:579bdeffedb987789bcddcb975310013
-- 005:56789abcdffecbbbba87544443100234
-- 006:79bdefedb8ba97656787656532345656
-- 007:43210123579bcdefedca865432112234
-- 008:9acdeffedccddca96532112210012356
-- 009:4201369cfc9631234201369cfc963123
-- 010:8acefeca86468ac963579b9753101357
-- 011:79bccb97410358bdffdb853357899856
-- 012:655679bcdeeeedca87655679abba9877
-- 013:0000ffff0000ffff0000ffff0000ffff
-- 014:0369cffdb98653210000000000000000
-- </WAVES>

-- <SFX>
-- 000:0e001e003e006e0f9e0ece0cee0afe08fe00fe00fe00fe00fe00fe00fe00fe00fe00fe00fe00fe00fe00fe00fe00fe00fe00fe00fe00fe00fe00fe00270000000000
-- 001:00d010d030d060e090f0c0f0e0f0f0f0f0f0f0f0f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f0003f0000000000
-- 002:03f723c34380635e730c930ab309c308d308d308e308e308e308e308f308f308f308f308f308f308f308f308f308f308f308f308f308f308f308f308b80000000000
-- 012:030013012300330f430043014300430f430043014300430f430043014300430f330023011300030f030003011300230f330043016300930fc300f301600000000000
-- 051:0ec01ec03ec06ecf9ececedceedafe08fe00fe00fe00fe00fe00fe00fe00fe00fe00fe00fe00fe00fe00fe00fe00fe00fe00fe00fe00fe00fe00fe003f0000000000
-- 061:330033013300330f430043014300430f430043014300430f430043013300330f230013010300030f030013011300230f230043016300930fc300e301604000000000
-- 062:04001400240034003400440044004400540064006400740084009400a400b400b400c400d400d400d400e400f400f400f400f400f400f400f400f400305000000000
-- 063:0f001f003f006f009f00cf00ef00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00300000000000
-- </SFX>

-- <PATTERNS>
-- 000:400004000010000020000000400004000000000020000010400004000000000020000010400004000000000020000000400004000010000020000000400004000020000020000020400004000000000020000000400004000000000020000000400004000010000020000000400004000000000020000000400004000000000020000000400004000000000020000000400004000010000010000000400004000000000020000000400004000000000020000000400004000000000020000000
-- 001:000000000020000000000020000000000020000000000020000000000020000000000020000000000020000000000000000000600016400026000000000000000020400026000000000000000020400026000000000000000020400026000000000000600018400026000000000000000020400026000000000000000020400026000000000000000020400026000000000000600016800016000000000000000020400026000000000000000020400026000000000000000020400026000000
-- 015:000000000020000000000020000000000020000000000020000000000020000000000020000000000020000000000000000000600016400026000000000000000020400026000000000000000020400026000000000000000020400026000000000000600018400026000000000000000020400026000000000000000020400026000000000000000020400026000000000000600016800016000000000000000020400026000000000000000020400026000000000000000020400026000000
-- 016:000000600018400026000010000000000000400026000000000000000000400026000000000000000000400026000000000000600016800016000000000000000000400026000000000000000000400026000000000000000000400026000000000000600018400026000000000000000000400026000000000000000000400026000000000000000000400026000000000000600016800016000000000000000000400026000000000000000000400026000000000000000000400026000000
-- 031:0000000000c00000000000000000000000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000000000005000ca7000ca8000ca7000ca0000008000ca7000ca6000ca1000c06000ca6000ca6000ca7000ca8000ca0000000000005000ca7000ca8000ca7000ca0000008000ca7000ca6000ca1000c06000ca6000ca6000ca8000ca7000ca000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 032:0000000000c00000000000000000000000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000000000005000ca7000ca8000ca7000ca0000008000ca7000ca6000ca1000c06000ca6000ca6000ca7000ca8000ca0000000000005000ca7000ca8000ca7000ca0000008000ca7000ca6000ca1000c06000ca6000ca6000ca8000ca7000ca000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </PATTERNS>

-- <TRACKS>
-- 000:104000144020144120000000000000000000000000000000000000000000000000000000000000000000000000000000ec0000
-- </TRACKS>

-- <FLAGS>
-- 000:10100000000050100018181818000000202010100000101000181818180000002020001000002000000000000000000010101000000020000000101010000000000010000000200000001010101000000000101000000000001080808080100000000010000000001000808080800010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </FLAGS>

-- <PALETTE>
-- 000:2f2a35443d386256539a5d40a981433b42626f7777989da0c2b8a9d9dbba000404ffffffd9dbbaffca10ee381c000000
-- 001:2f2a35000000000000000000000000000000000000000000000000000000000000000000d9dbbaffca10ee381c000000
-- </PALETTE>

-- <PALETTE1>
-- 000:2f2a35443d386256539a5d40a981433b42626f7777989da0c2b8a9d9dbba000404ffffff000000000000000000000000
-- </PALETTE1>

